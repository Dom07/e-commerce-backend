function cov_2orxwxlbcg(){var path="D:\\Projects\\ExpressJs\\e-commerce-backend\\helpers\\order.js";var hash="d45d4111c6d163c7a344cfb3afef97a80bbd2461";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"D:\\Projects\\ExpressJs\\e-commerce-backend\\helpers\\order.js",statementMap:{"0":{start:{line:1,column:9},end:{line:1,column:29}},"1":{start:{line:2,column:22},end:{line:2,column:51}},"2":{start:{line:3,column:16},end:{line:3,column:50}},"3":{start:{line:5,column:0},end:{line:66,column:1}},"4":{start:{line:6,column:4},end:{line:6,column:53}},"5":{start:{line:7,column:4},end:{line:7,column:60}},"6":{start:{line:8,column:4},end:{line:8,column:48}},"7":{start:{line:9,column:4},end:{line:65,column:10}},"8":{start:{line:23,column:28},end:{line:23,column:30}},"9":{start:{line:24,column:12},end:{line:41,column:14}},"10":{start:{line:25,column:16},end:{line:40,column:22}},"11":{start:{line:29,column:24},end:{line:29,column:41}},"12":{start:{line:30,column:24},end:{line:39,column:25}},"13":{start:{line:31,column:28},end:{line:36,column:111}},"14":{start:{line:35,column:44},end:{line:35,column:48}},"15":{start:{line:36,column:48},end:{line:36,column:110}},"16":{start:{line:38,column:28},end:{line:38,column:79}},"17":{start:{line:42,column:12},end:{line:42,column:54}},"18":{start:{line:43,column:12},end:{line:60,column:97}},"19":{start:{line:47,column:20},end:{line:57,column:21}},"20":{start:{line:48,column:24},end:{line:51,column:26}},"21":{start:{line:53,column:24},end:{line:56,column:26}},"22":{start:{line:60,column:32},end:{line:60,column:96}},"23":{start:{line:63,column:12},end:{line:63,column:30}},"24":{start:{line:64,column:12},end:{line:64,column:40}},"25":{start:{line:68,column:0},end:{line:81,column:1}},"26":{start:{line:69,column:4},end:{line:80,column:10}},"27":{start:{line:79,column:12},end:{line:79,column:42}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:21},end:{line:5,column:22}},loc:{start:{line:5,column:35},end:{line:66,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:22,column:14},end:{line:22,column:15}},loc:{start:{line:22,column:23},end:{line:61,column:9}},line:22},"2":{name:"(anonymous_2)",decl:{start:{line:24,column:38},end:{line:24,column:39}},loc:{start:{line:24,column:46},end:{line:41,column:13}},line:24},"3":{name:"(anonymous_3)",decl:{start:{line:28,column:20},end:{line:28,column:21}},loc:{start:{line:28,column:30},end:{line:40,column:21}},line:28},"4":{name:"(anonymous_4)",decl:{start:{line:35,column:38},end:{line:35,column:39}},loc:{start:{line:35,column:44},end:{line:35,column:48}},line:35},"5":{name:"(anonymous_5)",decl:{start:{line:36,column:39},end:{line:36,column:40}},loc:{start:{line:36,column:48},end:{line:36,column:110}},line:36},"6":{name:"(anonymous_6)",decl:{start:{line:46,column:22},end:{line:46,column:23}},loc:{start:{line:46,column:34},end:{line:59,column:17}},line:46},"7":{name:"(anonymous_7)",decl:{start:{line:60,column:23},end:{line:60,column:24}},loc:{start:{line:60,column:32},end:{line:60,column:96}},line:60},"8":{name:"(anonymous_8)",decl:{start:{line:62,column:15},end:{line:62,column:16}},loc:{start:{line:62,column:24},end:{line:65,column:9}},line:62},"9":{name:"(anonymous_9)",decl:{start:{line:68,column:20},end:{line:68,column:21}},loc:{start:{line:68,column:34},end:{line:81,column:1}},line:68},"10":{name:"(anonymous_10)",decl:{start:{line:78,column:14},end:{line:78,column:15}},loc:{start:{line:78,column:23},end:{line:80,column:9}},line:78}},branchMap:{"0":{loc:{start:{line:30,column:24},end:{line:39,column:25}},type:"if",locations:[{start:{line:30,column:24},end:{line:39,column:25}},{start:{line:30,column:24},end:{line:39,column:25}}],line:30},"1":{loc:{start:{line:47,column:20},end:{line:57,column:21}},type:"if",locations:[{start:{line:47,column:20},end:{line:57,column:21}},{start:{line:47,column:20},end:{line:57,column:21}}],line:47}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"d45d4111c6d163c7a344cfb3afef97a80bbd2461"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_2orxwxlbcg=function(){return actualCoverage;};return actualCoverage;}cov_2orxwxlbcg();var db=(cov_2orxwxlbcg().s[0]++,require('../models'));const productHelper=(cov_2orxwxlbcg().s[1]++,require('../helpers/product'));const helpers=(cov_2orxwxlbcg().s[2]++,require('../helpers/shoppingCart'));cov_2orxwxlbcg().s[3]++;exports.placeOrder=(req,res)=>{cov_2orxwxlbcg().f[0]++;cov_2orxwxlbcg().s[4]++;console.log("customerId: ",req.body.customer_id);cov_2orxwxlbcg().s[5]++;console.log("shoppingCartId: ",req.body.shoppingCartId);cov_2orxwxlbcg().s[6]++;console.log("products: ",req.body.products);cov_2orxwxlbcg().s[7]++;db.Order.create({orderDate:Date.now(),status:"Processing",product:[],shippingAddress:req.body.shippingAddress,totalPrice:req.body.totalPrice,paymentDetails:{cardHolderName:req.body.cardHolderName,cardNumber:req.body.cardNumber,expiryDate:req.body.expiryDate,CVV:req.body.CVV}}).then(order=>{cov_2orxwxlbcg().f[1]++;const message=(cov_2orxwxlbcg().s[8]++,[]);cov_2orxwxlbcg().s[9]++;req.body.products.forEach(item=>{cov_2orxwxlbcg().f[2]++;cov_2orxwxlbcg().s[10]++;productHelper.getProductCountAndReduce(item.quantity,item.productId._id,result=>{cov_2orxwxlbcg().f[3]++;cov_2orxwxlbcg().s[11]++;console.log(item);cov_2orxwxlbcg().s[12]++;if(result){cov_2orxwxlbcg().b[0][0]++;cov_2orxwxlbcg().s[13]++;db.Order.findByIdAndUpdate(order._id,{$push:{product:item}},{safe:true,upsert:true}).then(()=>{cov_2orxwxlbcg().f[4]++;cov_2orxwxlbcg().s[14]++;return null;}).catch(error=>{cov_2orxwxlbcg().f[5]++;cov_2orxwxlbcg().s[15]++;return console.log("Error adding product to order document: ",error);});}else{cov_2orxwxlbcg().b[0][1]++;cov_2orxwxlbcg().s[16]++;message.push(item.productId._id+" is out of stock");}});});cov_2orxwxlbcg().s[17]++;helpers.clearCart(req.body.shoppingCartId);cov_2orxwxlbcg().s[18]++;db.Customer.findByIdAndUpdate(req.body.customer_id,{$push:{order:order}},{safe:true,upsert:true}).then(customer=>{cov_2orxwxlbcg().f[6]++;cov_2orxwxlbcg().s[19]++;if(message.length>0){cov_2orxwxlbcg().b[1][0]++;cov_2orxwxlbcg().s[20]++;res.send({"FAILED":"One or more items out of stock","MESSAGE":message});}else{cov_2orxwxlbcg().b[1][1]++;cov_2orxwxlbcg().s[21]++;res.send({"SUCCESS":customer,"MESSAGE":"No Error"});}}).catch(error=>{cov_2orxwxlbcg().f[7]++;cov_2orxwxlbcg().s[22]++;return console.log("ERROR while pushing to customer document: ",error);});}).catch(error=>{cov_2orxwxlbcg().f[8]++;cov_2orxwxlbcg().s[23]++;console.log(error);cov_2orxwxlbcg().s[24]++;res.send({"ERROR":error});});};cov_2orxwxlbcg().s[25]++;exports.getOrders=(req,res)=>{cov_2orxwxlbcg().f[9]++;cov_2orxwxlbcg().s[26]++;db.Customer.findOne({_id:req.params.customerId},"order").populate({path:"order",select:"orderDate status totalPrice product",populate:{path:"product.productId",select:"name image price"}}).then(order=>{cov_2orxwxlbcg().f[10]++;cov_2orxwxlbcg().s[27]++;res.send({"SUCCESS":order});});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9yZGVyLmpzIl0sIm5hbWVzIjpbImRiIiwicmVxdWlyZSIsInByb2R1Y3RIZWxwZXIiLCJoZWxwZXJzIiwiZXhwb3J0cyIsInBsYWNlT3JkZXIiLCJyZXEiLCJyZXMiLCJjb25zb2xlIiwibG9nIiwiYm9keSIsImN1c3RvbWVyX2lkIiwic2hvcHBpbmdDYXJ0SWQiLCJwcm9kdWN0cyIsIk9yZGVyIiwiY3JlYXRlIiwib3JkZXJEYXRlIiwiRGF0ZSIsIm5vdyIsInN0YXR1cyIsInByb2R1Y3QiLCJzaGlwcGluZ0FkZHJlc3MiLCJ0b3RhbFByaWNlIiwicGF5bWVudERldGFpbHMiLCJjYXJkSG9sZGVyTmFtZSIsImNhcmROdW1iZXIiLCJleHBpcnlEYXRlIiwiQ1ZWIiwidGhlbiIsIm9yZGVyIiwibWVzc2FnZSIsImZvckVhY2giLCJpdGVtIiwiZ2V0UHJvZHVjdENvdW50QW5kUmVkdWNlIiwicXVhbnRpdHkiLCJwcm9kdWN0SWQiLCJfaWQiLCJyZXN1bHQiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRwdXNoIiwic2FmZSIsInVwc2VydCIsImNhdGNoIiwiZXJyb3IiLCJwdXNoIiwiY2xlYXJDYXJ0IiwiQ3VzdG9tZXIiLCJjdXN0b21lciIsImxlbmd0aCIsInNlbmQiLCJnZXRPcmRlcnMiLCJmaW5kT25lIiwicGFyYW1zIiwiY3VzdG9tZXJJZCIsInBvcHVsYXRlIiwicGF0aCIsInNlbGVjdCJdLCJtYXBwaW5ncyI6IjA4SUFBQSxHQUFJQSxDQUFBQSxFQUFFLDBCQUFHQyxPQUFPLENBQUMsV0FBRCxDQUFWLENBQU4sQ0FDQSxLQUFNQyxDQUFBQSxhQUFhLDBCQUFHRCxPQUFPLENBQUMsb0JBQUQsQ0FBVixDQUFuQixDQUNBLEtBQU1FLENBQUFBLE9BQU8sMEJBQUdGLE9BQU8sQ0FBQyx5QkFBRCxDQUFWLENBQWIsQyx3QkFFQUcsT0FBTyxDQUFDQyxVQUFSLENBQXFCLENBQUNDLEdBQUQsQ0FBTUMsR0FBTixHQUFjLGlEQUMvQkMsT0FBTyxDQUFDQyxHQUFS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Q0FBVCxFQUlILENBRUosQ0FoQkwsRUFpQktMLEtBakJMLENBaUJXQyxLQUFLLEVBQUksd0RBQUFuQyxDQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSw0Q0FBWixDQUEwRGtDLEtBQTFELEVBQWdFLENBakJwRixFQWtCSCxDQXBETCxFQXFES0QsS0FyREwsQ0FxRFdDLEtBQUssRUFBSSxrREFDWm5DLE9BQU8sQ0FBQ0MsR0FBUixDQUFZa0MsS0FBWixFQURZLHlCQUVacEMsR0FBRyxDQUFDMEMsSUFBSixDQUFTLENBQUUsUUFBU04sS0FBWCxDQUFULEVBQ0gsQ0F4REwsRUF5REgsQ0E3REQsQyx5QkErREF2QyxPQUFPLENBQUM4QyxTQUFSLENBQW9CLENBQUM1QyxHQUFELENBQU1DLEdBQU4sR0FBYyxrREFDOUJQLEVBQUUsQ0FBQzhDLFFBQUgsQ0FBWUssT0FBWixDQUFvQixDQUFFZixHQUFHLENBQUU5QixHQUFHLENBQUM4QyxNQUFKLENBQVdDLFVBQWxCLENBQXBCLENBQW9ELE9BQXBELEVBQ0tDLFFBREwsQ0FDYyxDQUNOQyxJQUFJLENBQUUsT0FEQSxDQUVOQyxNQUFNLENBQUUscUNBRkYsQ0FHTkYsUUFBUSxDQUFFLENBQ05DLElBQUksQ0FBRSxtQkFEQSxDQUVOQyxNQUFNLENBQUUsa0JBRkYsQ0FISixDQURkLEVBU0s1QixJQVRMLENBU1VDLEtBQUssRUFBSSxtREFDWHRCLEdBQUcsQ0FBQzBDLElBQUosQ0FBUyxDQUFFLFVBQVdwQixLQUFiLENBQVQsRUFDSCxDQVhMLEVBWUgsQ0FiRCIsInNvdXJjZXNDb250ZW50IjpbInZhciBkYiA9IHJlcXVpcmUoJy4uL21vZGVscycpXHJcbmNvbnN0IHByb2R1Y3RIZWxwZXIgPSByZXF1aXJlKCcuLi9oZWxwZXJzL3Byb2R1Y3QnKVxyXG5jb25zdCBoZWxwZXJzID0gcmVxdWlyZSgnLi4vaGVscGVycy9zaG9wcGluZ0NhcnQnKVxyXG5cclxuZXhwb3J0cy5wbGFjZU9yZGVyID0gKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhcImN1c3RvbWVySWQ6IFwiLCByZXEuYm9keS5jdXN0b21lcl9pZClcclxuICAgIGNvbnNvbGUubG9nKFwic2hvcHBpbmdDYXJ0SWQ6IFwiLCByZXEuYm9keS5zaG9wcGluZ0NhcnRJZClcclxuICAgIGNvbnNvbGUubG9nKFwicHJvZHVjdHM6IFwiLCByZXEuYm9keS5wcm9kdWN0cylcclxuICAgIGRiLk9yZGVyLmNyZWF0ZSh7XHJcbiAgICAgICAgb3JkZXJEYXRlOiBEYXRlLm5vdygpLFxyXG4gICAgICAgIHN0YXR1czogXCJQcm9jZXNzaW5nXCIsXHJcbiAgICAgICAgcHJvZHVjdDogW10sXHJcbiAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiByZXEuYm9keS5zaGlwcGluZ0FkZHJlc3MsXHJcbiAgICAgICAgdG90YWxQcmljZTogcmVxLmJvZHkudG90YWxQcmljZSxcclxuICAgICAgICBwYXltZW50RGV0YWlsczoge1xyXG4gICAgICAgICAgICBjYXJkSG9sZGVyTmFtZTogcmVxLmJvZHkuY2FyZEhvbGRlck5hbWUsXHJcbiAgICAgICAgICAgIGNhcmROdW1iZXI6IHJlcS5ib2R5LmNhcmROdW1iZXIsXHJcbiAgICAgICAgICAgIGV4cGlyeURhdGU6IHJlcS5ib2R5LmV4cGlyeURhdGUsXHJcbiAgICAgICAgICAgIENWVjogcmVxLmJvZHkuQ1ZWXHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuICAgICAgICAudGhlbihvcmRlciA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBbXVxyXG4gICAgICAgICAgICByZXEuYm9keS5wcm9kdWN0cy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgcHJvZHVjdEhlbHBlci5nZXRQcm9kdWN0Q291bnRBbmRSZWR1Y2UoXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5xdWFudGl0eSxcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnByb2R1Y3RJZC5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGIuT3JkZXIuZmluZEJ5SWRBbmRVcGRhdGUob3JkZXIuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgJHB1c2g6IHsgcHJvZHVjdDogaXRlbSB9IH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBzYWZlOiB0cnVlLCB1cHNlcnQ6IHRydWUgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coXCJFcnJvciBhZGRpbmcgcHJvZHVjdCB0byBvcmRlciBkb2N1bWVudDogXCIsIGVycm9yKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucHVzaChpdGVtLnByb2R1Y3RJZC5faWQrXCIgaXMgb3V0IG9mIHN0b2NrXCIpIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgaGVscGVycy5jbGVhckNhcnQocmVxLmJvZHkuc2hvcHBpbmdDYXJ0SWQpXHJcbiAgICAgICAgICAgIGRiLkN1c3RvbWVyLmZpbmRCeUlkQW5kVXBkYXRlKHJlcS5ib2R5LmN1c3RvbWVyX2lkLFxyXG4gICAgICAgICAgICAgICAgeyAkcHVzaDogeyBvcmRlcjogb3JkZXIgfSB9LFxyXG4gICAgICAgICAgICAgICAgeyBzYWZlOiB0cnVlLCB1cHNlcnQ6IHRydWUgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGN1c3RvbWVyID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZihtZXNzYWdlLmxlbmd0aD4wKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJGQUlMRURcIjogXCJPbmUgb3IgbW9yZSBpdGVtcyBvdXQgb2Ygc3RvY2tcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiTUVTU0FHRVwiOiBtZXNzYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKHsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlNVQ0NFU1NcIjogY3VzdG9tZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIk1FU1NBR0VcIjogXCJObyBFcnJvclwiIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmxvZyhcIkVSUk9SIHdoaWxlIHB1c2hpbmcgdG8gY3VzdG9tZXIgZG9jdW1lbnQ6IFwiLCBlcnJvcikpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgICAgICAgICAgcmVzLnNlbmQoeyBcIkVSUk9SXCI6IGVycm9yIH0pXHJcbiAgICAgICAgfSlcclxufVxyXG5cclxuZXhwb3J0cy5nZXRPcmRlcnMgPSAocmVxLCByZXMpID0+IHtcclxuICAgIGRiLkN1c3RvbWVyLmZpbmRPbmUoeyBfaWQ6IHJlcS5wYXJhbXMuY3VzdG9tZXJJZCB9LCBcIm9yZGVyXCIpXHJcbiAgICAgICAgLnBvcHVsYXRlKHtcclxuICAgICAgICAgICAgcGF0aDogXCJvcmRlclwiLFxyXG4gICAgICAgICAgICBzZWxlY3Q6IFwib3JkZXJEYXRlIHN0YXR1cyB0b3RhbFByaWNlIHByb2R1Y3RcIixcclxuICAgICAgICAgICAgcG9wdWxhdGU6IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IFwicHJvZHVjdC5wcm9kdWN0SWRcIixcclxuICAgICAgICAgICAgICAgIHNlbGVjdDogXCJuYW1lIGltYWdlIHByaWNlXCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4ob3JkZXIgPT4ge1xyXG4gICAgICAgICAgICByZXMuc2VuZCh7IFwiU1VDQ0VTU1wiOiBvcmRlciB9KVxyXG4gICAgICAgIH0pXHJcbn0iXX0=