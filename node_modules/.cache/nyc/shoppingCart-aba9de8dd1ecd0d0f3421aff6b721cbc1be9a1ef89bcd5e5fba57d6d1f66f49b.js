function cov_1ftf3f6eht(){var path="D:\\Projects\\ExpressJs\\e-commerce-backend\\helpers\\shoppingCart.js";var hash="531cae226cb3ef2cbc5313ee870325360420dd62";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"D:\\Projects\\ExpressJs\\e-commerce-backend\\helpers\\shoppingCart.js",statementMap:{"0":{start:{line:1,column:11},end:{line:1,column:31}},"1":{start:{line:3,column:0},end:{line:19,column:1}},"2":{start:{line:4,column:4},end:{line:18,column:42}},"3":{start:{line:16,column:12},end:{line:16,column:49}},"4":{start:{line:18,column:24},end:{line:18,column:41}},"5":{start:{line:46,column:0},end:{line:60,column:1}},"6":{start:{line:47,column:4},end:{line:59,column:10}},"7":{start:{line:49,column:12},end:{line:58,column:18}},"8":{start:{line:51,column:34},end:{line:53,column:22}},"9":{start:{line:52,column:24},end:{line:52,column:67}},"10":{start:{line:54,column:20},end:{line:54,column:64}},"11":{start:{line:54,column:34},end:{line:54,column:64}},"12":{start:{line:55,column:20},end:{line:57,column:56}},"13":{start:{line:56,column:38},end:{line:56,column:74}},"14":{start:{line:57,column:40},end:{line:57,column:55}},"15":{start:{line:62,column:0},end:{line:79,column:1}},"16":{start:{line:63,column:4},end:{line:78,column:10}},"17":{start:{line:65,column:12},end:{line:77,column:18}},"18":{start:{line:67,column:20},end:{line:71,column:21}},"19":{start:{line:72,column:20},end:{line:72,column:55}},"20":{start:{line:73,column:20},end:{line:76,column:69}},"21":{start:{line:74,column:24},end:{line:74,column:53}},"22":{start:{line:76,column:40},end:{line:76,column:68}},"23":{start:{line:81,column:0},end:{line:89,column:1}},"24":{start:{line:82,column:4},end:{line:88,column:6}},"25":{start:{line:84,column:8},end:{line:84,column:26}},"26":{start:{line:85,column:8},end:{line:87,column:30}},"27":{start:{line:86,column:22},end:{line:86,column:26}},"28":{start:{line:87,column:24},end:{line:87,column:29}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:3,column:19},end:{line:3,column:20}},loc:{start:{line:3,column:33},end:{line:19,column:1}},line:3},"1":{name:"(anonymous_1)",decl:{start:{line:15,column:14},end:{line:15,column:15}},loc:{start:{line:15,column:30},end:{line:17,column:9}},line:15},"2":{name:"(anonymous_2)",decl:{start:{line:18,column:15},end:{line:18,column:16}},loc:{start:{line:18,column:24},end:{line:18,column:41}},line:18},"3":{name:"(anonymous_3)",decl:{start:{line:46,column:29},end:{line:46,column:30}},loc:{start:{line:46,column:43},end:{line:60,column:1}},line:46},"4":{name:"(anonymous_4)",decl:{start:{line:48,column:14},end:{line:48,column:15}},loc:{start:{line:48,column:26},end:{line:59,column:9}},line:48},"5":{name:"(anonymous_5)",decl:{start:{line:50,column:22},end:{line:50,column:23}},loc:{start:{line:50,column:30},end:{line:58,column:17}},line:50},"6":{name:"(anonymous_6)",decl:{start:{line:51,column:58},end:{line:51,column:59}},loc:{start:{line:51,column:66},end:{line:53,column:21}},line:51},"7":{name:"(anonymous_7)",decl:{start:{line:56,column:30},end:{line:56,column:31}},loc:{start:{line:56,column:38},end:{line:56,column:74}},line:56},"8":{name:"(anonymous_8)",decl:{start:{line:57,column:31},end:{line:57,column:32}},loc:{start:{line:57,column:40},end:{line:57,column:55}},line:57},"9":{name:"(anonymous_9)",decl:{start:{line:62,column:20},end:{line:62,column:21}},loc:{start:{line:62,column:34},end:{line:79,column:1}},line:62},"10":{name:"(anonymous_10)",decl:{start:{line:64,column:14},end:{line:64,column:15}},loc:{start:{line:64,column:26},end:{line:78,column:9}},line:64},"11":{name:"(anonymous_11)",decl:{start:{line:66,column:22},end:{line:66,column:23}},loc:{start:{line:66,column:38},end:{line:77,column:17}},line:66},"12":{name:"(anonymous_12)",decl:{start:{line:73,column:45},end:{line:73,column:46}},loc:{start:{line:73,column:53},end:{line:75,column:21}},line:73},"13":{name:"(anonymous_13)",decl:{start:{line:76,column:31},end:{line:76,column:32}},loc:{start:{line:76,column:40},end:{line:76,column:68}},line:76},"14":{name:"(anonymous_14)",decl:{start:{line:81,column:20},end:{line:81,column:21}},loc:{start:{line:81,column:31},end:{line:89,column:1}},line:81},"15":{name:"(anonymous_15)",decl:{start:{line:83,column:10},end:{line:83,column:11}},loc:{start:{line:83,column:18},end:{line:88,column:5}},line:83},"16":{name:"(anonymous_16)",decl:{start:{line:86,column:14},end:{line:86,column:15}},loc:{start:{line:86,column:22},end:{line:86,column:26}},line:86},"17":{name:"(anonymous_17)",decl:{start:{line:87,column:15},end:{line:87,column:16}},loc:{start:{line:87,column:24},end:{line:87,column:29}},line:87}},branchMap:{"0":{loc:{start:{line:54,column:20},end:{line:54,column:64}},type:"if",locations:[{start:{line:54,column:20},end:{line:54,column:64}},{start:{line:54,column:20},end:{line:54,column:64}}],line:54}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"531cae226cb3ef2cbc5313ee870325360420dd62"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1ftf3f6eht=function(){return actualCoverage;};return actualCoverage;}cov_1ftf3f6eht();const db=(cov_1ftf3f6eht().s[0]++,require('../models'));cov_1ftf3f6eht().s[1]++;exports.viewCart=(req,res)=>{cov_1ftf3f6eht().f[0]++;cov_1ftf3f6eht().s[2]++;db.Customer.findOne({_id:req.params.customer_id},'shoppingCart').populate([{path:"shoppingCart",model:"ShoppingCart",populate:{path:"products.productId",select:"image price name quantity"}}]).then(shoppingCart=>{cov_1ftf3f6eht().f[1]++;cov_1ftf3f6eht().s[3]++;res.send({"SUCCESS":shoppingCart});}).catch(error=>{cov_1ftf3f6eht().f[2]++;cov_1ftf3f6eht().s[4]++;return res.send("ERROR");});};/* istanbul ignore next */exports.updateCart=(req,res)=>{db.Customer.findOne({_id:req.body.customer_id},'shoppingCart').populate('shoppingCart').then(customer=>{console.log(customer);db.ShoppingCart.findOne({_id:customer.shoppingCart}).then(cart=>{index=cart.products.findIndex(item=>item.productId==req.body.product_id);cart.products[index]["quantity"]=req.body.quantity;cart.products[index]["dateAdded"]=new Date();cart.save().then(cart=>res.send({"SUCCESS":cart})).catch(error=>{res.send({"ERROR":"Failed to update cart"});console.log(error);});}).catch(error=>{res.send({"ERROR":"Failed to update cart"});console.log(error);});});};cov_1ftf3f6eht().s[5]++;exports.removeItemFromCart=(req,res)=>{cov_1ftf3f6eht().f[3]++;cov_1ftf3f6eht().s[6]++;db.Customer.findOne({_id:req.body.customer_id},'shoppingCart').then(response=>{cov_1ftf3f6eht().f[4]++;cov_1ftf3f6eht().s[7]++;db.ShoppingCart.findOne({_id:response.shoppingCart}).then(cart=>{cov_1ftf3f6eht().f[5]++;const index=(cov_1ftf3f6eht().s[8]++,cart.products.findIndex(item=>{cov_1ftf3f6eht().f[6]++;cov_1ftf3f6eht().s[9]++;return item.productId==req.body.productId;}));cov_1ftf3f6eht().s[10]++;if(index!=-1){cov_1ftf3f6eht().b[0][0]++;cov_1ftf3f6eht().s[11]++;cart.products.splice(index,1);}else{cov_1ftf3f6eht().b[0][1]++;}cov_1ftf3f6eht().s[12]++;cart.save().then(cart=>{cov_1ftf3f6eht().f[7]++;cov_1ftf3f6eht().s[13]++;return res.send({"SUCCESS":cart.products});}).catch(error=>{cov_1ftf3f6eht().f[8]++;cov_1ftf3f6eht().s[14]++;return res.send(error);});});});};cov_1ftf3f6eht().s[15]++;exports.addToCart=(req,res)=>{cov_1ftf3f6eht().f[9]++;cov_1ftf3f6eht().s[16]++;db.Customer.findOne({_id:req.body.customer_id},'shoppingCart').then(customer=>{cov_1ftf3f6eht().f[10]++;cov_1ftf3f6eht().s[17]++;db.ShoppingCart.findOne({_id:customer.shoppingCart}).then(shoppingCart=>{cov_1ftf3f6eht().f[11]++;cov_1ftf3f6eht().s[18]++;product={productId:req.body.product_id,quantity:1,dateAdded:new Date()};cov_1ftf3f6eht().s[19]++;shoppingCart.products.push(product);cov_1ftf3f6eht().s[20]++;shoppingCart.save().then(cart=>{cov_1ftf3f6eht().f[12]++;cov_1ftf3f6eht().s[21]++;res.send({"SUCCESS":cart});}).catch(error=>{cov_1ftf3f6eht().f[13]++;cov_1ftf3f6eht().s[22]++;return res.send({"ERROR":error});});});});};cov_1ftf3f6eht().s[23]++;exports.clearCart=cartId=>{cov_1ftf3f6eht().f[14]++;cov_1ftf3f6eht().s[24]++;db.ShoppingCart.findOne({_id:cartId}).then(cart=>{cov_1ftf3f6eht().f[15]++;cov_1ftf3f6eht().s[25]++;cart.products=[];cov_1ftf3f6eht().s[26]++;cart.save().then(cart=>{cov_1ftf3f6eht().f[16]++;cov_1ftf3f6eht().s[27]++;return true;}).catch(error=>{cov_1ftf3f6eht().f[17]++;cov_1ftf3f6eht().s[28]++;return error;});});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNob3BwaW5nQ2FydC5qcyJdLCJuYW1lcyI6WyJkYiIsInJlcXVpcmUiLCJleHBvcnRzIiwidmlld0NhcnQiLCJyZXEiLCJyZXMiLCJDdXN0b21lciIsImZpbmRPbmUiLCJfaWQiLCJwYXJhbXMiLCJjdXN0b21lcl9pZCIsInBvcHVsYXRlIiwicGF0aCIsIm1vZGVsIiwic2VsZWN0IiwidGhlbiIsInNob3BwaW5nQ2FydCIsInNlbmQiLCJjYXRjaCIsImVycm9yIiwidXBkYXRlQ2FydCIsImJvZHkiLCJjdXN0b21lciIsImNvbnNvbGUiLCJsb2ciLCJTaG9wcGluZ0NhcnQiLCJjYXJ0IiwiaW5kZXgiLCJwcm9kdWN0cyIsImZpbmRJbmRleCIsIml0ZW0iLCJwcm9kdWN0SWQiLCJwcm9kdWN0X2lkIiwicXVhbnRpdHkiLCJEYXRlIiwic2F2ZSIsInJlbW92ZUl0ZW1Gcm9tQ2FydCIsInJlc3BvbnNlIiwic3BsaWNlIiwiYWRkVG9DYXJ0IiwicHJvZHVjdCIsImRhdGVBZGRlZCIsInB1c2giLCJjbGVhckNhcnQiLCJjYXJ0SWQiXSwibWFwcGluZ3MiOiJvNUtBQUEsS0FBTUEsQ0FBQUEsRUFBRSwwQkFBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBVixDQUFSLEMsd0JBRUFDLE9BQU8sQ0FBQ0MsUUFBUixDQUFtQixDQUFDQyxHQUFELENBQU1DLEdBQU4sR0FBYyxpREFDN0JMLEVBQUUsQ0FBQ00sUUFBSCxDQUFZQyxPQUFaLENBQW9CLENBQUVDLEdBQUcsQ0FBRUosR0FBRyxDQUFDSyxNQUFKLENBQVdDLFdBQWxCLENBQXBCLENBQXFELGNBQXJELEVBQ0tDLFFBREwsQ0FDYyxDQUNOLENBQ0lDLElBQUksQ0FBRSxjQURWLENBRUlDLEtBQUssQ0FBRSxjQUZYLENBR0lGLFFBQVEsQ0FBRSxDQUNOQyxJQUFJLENBQUUsb0JBREEsQ0FFTkUsTUFBTSxDQUFFLDJCQUZGLENBSGQsQ0FETSxDQURkLEVBV0tDLElBWEwsQ0FXVUMsWUFBWSxFQUFJLGlEQUNsQlgsR0FBRyxD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QWFILENBZkwsRUFnQkgsQ0FqQkQsQyx5QkFtQkFqQixPQUFPLENBQUN5QyxTQUFSLENBQXFCQyxNQUFELEVBQVcsbURBQzNCNUMsRUFBRSxDQUFDeUIsWUFBSCxDQUFnQmxCLE9BQWhCLENBQXdCLENBQUNDLEdBQUcsQ0FBRW9DLE1BQU4sQ0FBeEIsRUFDQzdCLElBREQsQ0FDTVcsSUFBSSxFQUFJLG1EQUNWQSxJQUFJLENBQUNFLFFBQUwsQ0FBZ0IsRUFBaEIsQ0FEVSx5QkFFVkYsSUFBSSxDQUFDUyxJQUFMLEdBQ0NwQixJQURELENBQ01XLElBQUksRUFBSSwrREFBSSxDQURsQixFQUVDUixLQUZELENBRU9DLEtBQUssRUFBSUEseURBQUFBLENBQUFBLEtBQUssRUFGckIsRUFHSCxDQU5ELEVBT0gsQ0FSRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGRiID0gcmVxdWlyZSgnLi4vbW9kZWxzJylcclxuXHJcbmV4cG9ydHMudmlld0NhcnQgPSAocmVxLCByZXMpID0+IHtcclxuICAgIGRiLkN1c3RvbWVyLmZpbmRPbmUoeyBfaWQ6IHJlcS5wYXJhbXMuY3VzdG9tZXJfaWQgfSwgJ3Nob3BwaW5nQ2FydCcpXHJcbiAgICAgICAgLnBvcHVsYXRlKFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGF0aDogXCJzaG9wcGluZ0NhcnRcIixcclxuICAgICAgICAgICAgICAgIG1vZGVsOiBcIlNob3BwaW5nQ2FydFwiLFxyXG4gICAgICAgICAgICAgICAgcG9wdWxhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICBwYXRoOiBcInByb2R1Y3RzLnByb2R1Y3RJZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogXCJpbWFnZSBwcmljZSBuYW1lIHF1YW50aXR5XCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF0pXHJcbiAgICAgICAgLnRoZW4oc2hvcHBpbmdDYXJ0ID0+IHtcclxuICAgICAgICAgICAgcmVzLnNlbmQoeyBcIlNVQ0NFU1NcIjogc2hvcHBpbmdDYXJ0IH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gcmVzLnNlbmQoXCJFUlJPUlwiKSlcclxufVxyXG5cclxuLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cclxuXHJcbmV4cG9ydHMudXBkYXRlQ2FydCA9IChyZXEsIHJlcykgPT4ge1xyXG4gICAgZGIuQ3VzdG9tZXIuZmluZE9uZSh7IF9pZDogcmVxLmJvZHkuY3VzdG9tZXJfaWQgfSwgJ3Nob3BwaW5nQ2FydCcpLnBvcHVsYXRlKCdzaG9wcGluZ0NhcnQnKVxyXG4gICAgICAgIC50aGVuKGN1c3RvbWVyID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coY3VzdG9tZXIpXHJcbiAgICAgICAgICAgIGRiLlNob3BwaW5nQ2FydC5maW5kT25lKHsgX2lkOiBjdXN0b21lci5zaG9wcGluZ0NhcnQgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGNhcnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gY2FydC5wcm9kdWN0cy5maW5kSW5kZXgoaXRlbSA9PiAoaXRlbS5wcm9kdWN0SWQgPT0gcmVxLmJvZHkucHJvZHVjdF9pZCkpXHJcbiAgICAgICAgICAgICAgICAgICAgY2FydC5wcm9kdWN0c1tpbmRleF1bXCJxdWFudGl0eVwiXSA9IHJlcS5ib2R5LnF1YW50aXR5XHJcbiAgICAgICAgICAgICAgICAgICAgY2FydC5wcm9kdWN0c1tpbmRleF1bXCJkYXRlQWRkZWRcIl0gPSBuZXcgRGF0ZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgY2FydC5zYXZlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oY2FydCA9PiByZXMuc2VuZCh7IFwiU1VDQ0VTU1wiOiBjYXJ0IH0pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoeyBcIkVSUk9SXCI6IFwiRmFpbGVkIHRvIHVwZGF0ZSBjYXJ0XCIgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoeyBcIkVSUk9SXCI6IFwiRmFpbGVkIHRvIHVwZGF0ZSBjYXJ0XCIgfSlcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxufVxyXG5cclxuZXhwb3J0cy5yZW1vdmVJdGVtRnJvbUNhcnQgPSAocmVxLCByZXMpID0+IHtcclxuICAgIGRiLkN1c3RvbWVyLmZpbmRPbmUoeyBfaWQ6IHJlcS5ib2R5LmN1c3RvbWVyX2lkIH0sICdzaG9wcGluZ0NhcnQnKVxyXG4gICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgICAgZGIuU2hvcHBpbmdDYXJ0LmZpbmRPbmUoeyBfaWQ6IHJlc3BvbnNlLnNob3BwaW5nQ2FydCB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oY2FydCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjYXJ0LnByb2R1Y3RzLmZpbmRJbmRleChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ucHJvZHVjdElkID09IHJlcS5ib2R5LnByb2R1Y3RJZFxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaW5kZXghPS0xKSBjYXJ0LnByb2R1Y3RzLnNwbGljZShpbmRleCwgMSlcclxuICAgICAgICAgICAgICAgICAgICBjYXJ0LnNhdmUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihjYXJ0ID0+IHJlcy5zZW5kKHtcIlNVQ0NFU1NcIjogY2FydC5wcm9kdWN0c30pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gcmVzLnNlbmQoZXJyb3IpKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG59XHJcblxyXG5leHBvcnRzLmFkZFRvQ2FydCA9IChyZXEsIHJlcykgPT4ge1xyXG4gICAgZGIuQ3VzdG9tZXIuZmluZE9uZSh7IF9pZDogcmVxLmJvZHkuY3VzdG9tZXJfaWQgfSwgJ3Nob3BwaW5nQ2FydCcpXHJcbiAgICAgICAgLnRoZW4oY3VzdG9tZXIgPT4ge1xyXG4gICAgICAgICAgICBkYi5TaG9wcGluZ0NhcnQuZmluZE9uZSh7IF9pZDogY3VzdG9tZXIuc2hvcHBpbmdDYXJ0IH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihzaG9wcGluZ0NhcnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3QgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RJZDogcmVxLmJvZHkucHJvZHVjdF9pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVBZGRlZDogbmV3IERhdGUoKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzaG9wcGluZ0NhcnQucHJvZHVjdHMucHVzaChwcm9kdWN0KVxyXG4gICAgICAgICAgICAgICAgICAgIHNob3BwaW5nQ2FydC5zYXZlKCkudGhlbihjYXJ0ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoeyBcIlNVQ0NFU1NcIjogY2FydCB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiByZXMuc2VuZCh7IFwiRVJST1JcIjogZXJyb3IgfSkpXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbn1cclxuXHJcbmV4cG9ydHMuY2xlYXJDYXJ0ID0gKGNhcnRJZCkgPT57XHJcbiAgICBkYi5TaG9wcGluZ0NhcnQuZmluZE9uZSh7X2lkOiBjYXJ0SWR9KVxyXG4gICAgLnRoZW4oY2FydCA9PiB7XHJcbiAgICAgICAgY2FydC5wcm9kdWN0cyA9IFtdXHJcbiAgICAgICAgY2FydC5zYXZlKClcclxuICAgICAgICAudGhlbihjYXJ0ID0+IHRydWUpXHJcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IGVycm9yKVxyXG4gICAgfSlcclxufSJdfQ==