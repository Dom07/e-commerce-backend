function cov_q1zviav12(){var path="D:\\Projects\\ExpressJs\\e-commerce-backend\\helpers\\review.js";var hash="2eada17a929e125992fc2f983024cb57d93b4122";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"D:\\Projects\\ExpressJs\\e-commerce-backend\\helpers\\review.js",statementMap:{"0":{start:{line:1,column:9},end:{line:1,column:29}}},fnMap:{},branchMap:{},s:{"0":0},f:{},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"2eada17a929e125992fc2f983024cb57d93b4122"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_q1zviav12=function(){return actualCoverage;};return actualCoverage;}cov_q1zviav12();var db=(cov_q1zviav12().s[0]++,require('../models'));/* istanbul ignore next */exports.addReview=(req,res)=>{db.Product.findById(req.body.product_id).populate('review').then(product=>{db.Customer.findById(req.body.customer_id).then(customer=>{let responseFlag=false;product.review.forEach(rev=>{if(rev.customerId.toString()===customer._id.toString()){responseFlag=true;}});if(!responseFlag){db.Review.create({customerId:customer,description:req.body.description,rating:req.body.rating,date:Date.now()}).then(review=>{const oldRatings=product.ratings;const oldTotalRatings=product.review.length;const ratings=(oldRatings*oldTotalRatings+req.body.rating)/(oldRatings+1);db.Product.findByIdAndUpdate(req.body.product_id,{$push:{review:review},$set:{ratings:ratings}},{safe:true,upsert:true}).then(()=>res.send({"SUCCESS":true})).catch(error=>{console.log(error);res.send({"FAILED":true});});}).catch(error=>{console.log(error);res.send({"FAILED":true});});}else{res.send({"FAILED":"Review already given"});}}).catch(error=>console.log(error));}).catch(error=>{console.log(error);res.send({"FAILED":true});});};/* istanbul ignore next */exports.getReviewsByProductId=(req,res)=>{db.Product.findOne({_id:req.params.product_id},"review").populate({path:"review",populate:{path:"customerId",model:"Customer",select:"name"}}).then(product=>res.send(product)).catch(error=>res.send(error));};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJldmlldy5qcyJdLCJuYW1lcyI6WyJkYiIsInJlcXVpcmUiLCJleHBvcnRzIiwiYWRkUmV2aWV3IiwicmVxIiwicmVzIiwiUHJvZHVjdCIsImZpbmRCeUlkIiwiYm9keSIsInByb2R1Y3RfaWQiLCJwb3B1bGF0ZSIsInRoZW4iLCJwcm9kdWN0IiwiQ3VzdG9tZXIiLCJjdXN0b21lcl9pZCIsImN1c3RvbWVyIiwicmVzcG9uc2VGbGFnIiwicmV2aWV3IiwiZm9yRWFjaCIsInJldiIsImN1c3RvbWVySWQiLCJ0b1N0cmluZyIsIl9pZCIsIlJldmlldyIsImNyZWF0ZSIsImRlc2NyaXB0aW9uIiwicmF0aW5nIiwiZGF0ZSIsIkRhdGUiLCJub3ciLCJvbGRSYXRpbmdzIiwicmF0aW5ncyIsIm9sZFRvdGFsUmF0aW5ncyIsImxlbmd0aCIsImZpbmRCeUlkQW5kVXBkYXRlIiwiJHB1c2giLCIkc2V0Iiwic2FmZSIsInVwc2VydCIsInNlbmQiLCJjYXRjaCIsImVycm9yIiwiY29uc29sZSIsImxvZyIsImdldFJldmlld3NCeVByb2R1Y3RJZCIsImZpbmRPbmUiLCJwYXJhbXMiLCJwYXRoIiwibW9kZWwiLCJzZWxlY3QiXSwibWFwcGluZ3MiOiI2dkJBQUEsR0FBSUEsQ0FBQUEsRUFBRSx5QkFBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBVixDQUFOLENBRUEsMEJBR0FDLE9BQU8sQ0FBQ0MsU0FBUixDQUFvQixDQUFDQyxHQUFELENBQU1DLEdBQU4sR0FBYyxDQUM5QkwsRUFBRSxDQUFDTSxPQUFILENBQVdDLFFBQVgsQ0FBb0JILEdBQUcsQ0FBQ0ksSUFBSixDQUFTQyxVQUE3QixFQUF5Q0MsUUFBekMsQ0FBa0QsUUFBbEQsRUFDS0MsSUFETCxDQUNVQyxPQUFPLEVBQUksQ0FDYlosRUFBRSxDQUFDYSxRQUFILENBQVlOLFFBQVosQ0FBcUJILEdBQUcsQ0FBQ0ksSUFBSixDQUFTTSxXQUE5QixFQUNLSCxJQURMLENBQ1VJLFFBQVEsRUFBSSxDQUNkLEdBQUlDLENBQUFB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Q0FGSixDQURkLEVBU0t0QyxJQVRMLENBU1VDLE9BQU8sRUFBSVAsR0FBRyxDQUFDa0MsSUFBSixDQUFTM0IsT0FBVCxDQVRyQixFQVVLNEIsS0FWTCxDQVVXQyxLQUFLLEVBQUlwQyxHQUFHLENBQUNrQyxJQUFKLENBQVNFLEtBQVQsQ0FWcEIsRUFXSCxDQVpEIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGRiID0gcmVxdWlyZSgnLi4vbW9kZWxzJylcclxuXHJcbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXHJcblxyXG5cclxuZXhwb3J0cy5hZGRSZXZpZXcgPSAocmVxLCByZXMpID0+IHtcclxuICAgIGRiLlByb2R1Y3QuZmluZEJ5SWQocmVxLmJvZHkucHJvZHVjdF9pZCkucG9wdWxhdGUoJ3JldmlldycpXHJcbiAgICAgICAgLnRoZW4ocHJvZHVjdCA9PiB7XHJcbiAgICAgICAgICAgIGRiLkN1c3RvbWVyLmZpbmRCeUlkKHJlcS5ib2R5LmN1c3RvbWVyX2lkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oY3VzdG9tZXIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCByZXNwb25zZUZsYWcgPSBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3QucmV2aWV3LmZvckVhY2gocmV2ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldi5jdXN0b21lcklkLnRvU3RyaW5nKCkgPT09IGN1c3RvbWVyLl9pZC50b1N0cmluZygpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZUZsYWcgPSB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2VGbGFnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRiLlJldmlldy5jcmVhdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXJJZDogY3VzdG9tZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogcmVxLmJvZHkuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXRpbmc6IHJlcS5ib2R5LnJhdGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IERhdGUubm93KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHJldmlldyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2xkUmF0aW5ncyA9IHByb2R1Y3QucmF0aW5nc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZFRvdGFsUmF0aW5ncyA9IHByb2R1Y3QucmV2aWV3Lmxlbmd0aFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhdGluZ3MgPSAoKG9sZFJhdGluZ3MgKiBvbGRUb3RhbFJhdGluZ3MpICsgcmVxLmJvZHkucmF0aW5nKSAvIChvbGRSYXRpbmdzICsgMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYi5Qcm9kdWN0LmZpbmRCeUlkQW5kVXBkYXRlKHJlcS5ib2R5LnByb2R1Y3RfaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwdXNoOiB7IHJldmlldzogcmV2aWV3IH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2V0OiB7IHJhdGluZ3M6IHJhdGluZ3MgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHNhZmU6IHRydWUsIHVwc2VydDogdHJ1ZSB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiByZXMuc2VuZCh7IFwiU1VDQ0VTU1wiOiB0cnVlIH0pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc2VuZCh7IFwiRkFJTEVEXCI6IHRydWUgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc2VuZCh7IFwiRkFJTEVEXCI6IHRydWUgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoeyBcIkZBSUxFRFwiOiBcIlJldmlldyBhbHJlYWR5IGdpdmVuXCIgfSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUubG9nKGVycm9yKSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgICAgICAgICByZXMuc2VuZCh7IFwiRkFJTEVEXCI6IHRydWUgfSlcclxuICAgICAgICB9KVxyXG59XHJcblxyXG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xyXG5cclxuZXhwb3J0cy5nZXRSZXZpZXdzQnlQcm9kdWN0SWQgPSAocmVxLCByZXMpID0+IHtcclxuICAgIGRiLlByb2R1Y3QuZmluZE9uZSh7IF9pZDogcmVxLnBhcmFtcy5wcm9kdWN0X2lkIH0sIFwicmV2aWV3XCIpXHJcbiAgICAgICAgLnBvcHVsYXRlKHtcclxuICAgICAgICAgICAgcGF0aDogXCJyZXZpZXdcIixcclxuICAgICAgICAgICAgcG9wdWxhdGU6IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IFwiY3VzdG9tZXJJZFwiLFxyXG4gICAgICAgICAgICAgICAgbW9kZWw6IFwiQ3VzdG9tZXJcIixcclxuICAgICAgICAgICAgICAgIHNlbGVjdDogXCJuYW1lXCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4ocHJvZHVjdCA9PiByZXMuc2VuZChwcm9kdWN0KSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gcmVzLnNlbmQoZXJyb3IpKVxyXG59Il19